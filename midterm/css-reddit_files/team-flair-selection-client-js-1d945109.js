import{r as e,q as t,aa as a,a8 as s,a9 as r,u as i,S as o,ab as l,ac as n,x as d,d as c,ad as p,$ as h,f as m,aq as u,ar as f,c as b,_ as v,J as y,n as g,s as x,e as S}from"./shell-e94b58e1.js";import"./faceplate-bottom-sheet-header-2e304719.js";import"./faceplate-bottom-sheet-6635ac01.js";import"./TinyGesture-32f2fddd.js";const w=t=>e({source:"global",action:"view",noun:"screen"},{action_info:{page_type:t,reason:"subreddit"}}),k=({eventType:t,flairId:a,flairText:s})=>e({source:"flair_prompt",action:"submit",noun:"flair"},{action_info:{type:t,reason:"subreddit"},user_flair:{id:a,title:s}});var F;!function(e){e.Emoji="emoji",e.Text="text"}(F||(F={}));const T=/:(.*?):/g;let $=class extends(t(x)){constructor(){super(...arguments),this.isDesktopViewport=!1,this.subredditId="",this.subredditName="",this.username="",this.flairs=[],this.open=()=>{if(this.isDesktopViewport?(this.modal?.showModal(),this.trackEvent(w(a.FlairsModal))):(this.bottomSheet?.showModal(),this.trackEvent(w(a.FlairsList))),s.isAvailable()){const e=JSON.parse(s.getItem(r.TeamFlairSelectionIsShown)||"[]");s.setItem(r.TeamFlairSelectionIsShown,JSON.stringify([...e,this.subredditId]))}},this.close=()=>{this.isDesktopViewport?this.modal?.close():this.bottomSheet?.close()}}firstUpdated(){requestAnimationFrame((()=>{if(s.isAvailable()){if(JSON.parse(s.getItem(r.TeamFlairSelectionIsShown)||"[]").includes(this.subredditId))return}this.open()}))}async onFlairSelect(e,t,a){e.preventDefault();try{(await this.makeUpdateUserFlairRequest(t,a))?.data?.updateUserFlair?.ok?(this.dispatchEvent(i("faceplate-alert",{level:o.success,message:"Team joined!"})),this.trackEvent(k({eventType:"success",flairId:t,flairText:a.toString()}))):(this.showErrorMessage(),this.trackEvent(k({eventType:"failure",flairId:t,flairText:a.toString()})))}catch(e){window.Sentry?.captureError?.(e),this.showErrorMessage(),this.trackEvent(k({eventType:"failure",flairId:t,flairText:a.toString()}))}this.close()}async makeUpdateUserFlairRequest(e,t){return l({operation:n.UpdateUserFlairAndEnabledStatus,variables:{subredditId:this.subredditId??"",isEnabled:!0,flairTemplateId:e,text:t,shouldUpdateUserFlair:!0,shouldUpdateUserFlairEnabledStatus:!0,username:this.username??""}})}showErrorMessage(){this.dispatchEvent(i("faceplate-alert",{level:o.error,message:"Something went wrong"}))}getTitleText(){return`Choose your team for r/${this.subredditName}`}renderCloseButton(){const e=this.isDesktopViewport?a.FlairsModal:a.FlairsList;return d`<faceplate-tracker \n source="flair_prompt" \n action="click" \n noun="${e}" \n data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"dismiss"}})}" \n slot="closeButton" \n>\n ${c({appearance:"secondary",leadingIcon:p({size:h.Small}),size:m.Small,attributes:{onclick:this.close,className:"close-button","aria-label":"Close team flair selection modal"}})}</faceplate-tracker>`}renderFlairLabel(e){if(!e.text.match(T)||!e.richtext)return e.text.replace(T,"").trim();const t=JSON.parse(e.richtext);let a=d``;for(const e of t)e.e===F.Emoji&&(a=d` ${a}\n <img \n alt="Custom emoji set by the subreddit moderatos" \n src="${e.u}" \n class="w-md h-md mx-xs" \n>`),e.e===F.Text&&(a=d` ${a}\n <span>${e.t}</span>`);return a}renderFlairsList(){const e=this.isDesktopViewport?a.FlairsModal:a.FlairsList;return d`<faceplate-tracker \n source="flair_prompt" \n action="click" \n noun="${e}" \n data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"choose"}})}" \n>${this.flairs.map((e=>u({label:this.renderFlairLabel(e),size:f.Medium,onClick:t=>this.onFlairSelect(t,e.id,e.text),attributes:{className:"w-full text-18 [&_.flair-image]:align-text-bottom [&_.flair-image]:mr-2","aria-label":`A label for ${e.text}`}})))}</faceplate-tracker>`}renderModal(){return d`<faceplate-modal \n ?shouldContentScroll="${!0}" \n class="z-10 rounded-lg w-[370px] max-h-[600px] s:w-[454px] m:w-[455px]" \n>\n ${this.renderCloseButton()}\n <div slot="title" class="text-18">${this.getTitleText()}</div>\n <div class="flex flex-col justify-center w-full">${this.renderFlairsList()}</div>\n </faceplate-modal>`}renderBottomSheet(){return d`<faceplate-bottom-sheet>\n <faceplate-bottom-sheet-header slot="header" has-divider>\n ${this.getTitleText()}\n <span slot="trailing"> ${this.renderCloseButton()}</span>\n </faceplate-bottom-sheet-header>\n <div class="box-border p-md pb-lg w-full overflow-y-scroll">${this.renderFlairsList()}</div>\n </faceplate-bottom-sheet>`}render(){return this.isDesktopViewport?this.renderModal():this.renderBottomSheet()}};$.styles=[b],v([y("faceplate-modal")],$.prototype,"modal",void 0),v([y("faceplate-bottom-sheet")],$.prototype,"bottomSheet",void 0),v([g({type:Boolean,attribute:"is-desktop-viewport"})],$.prototype,"isDesktopViewport",void 0),v([g({type:String,attribute:"subreddit-id"})],$.prototype,"subredditId",void 0),v([g({type:String,attribute:"subreddit-name"})],$.prototype,"subredditName",void 0),v([g({type:String,attribute:"username"})],$.prototype,"username",void 0),v([g({type:Array,attribute:"flairs"})],$.prototype,"flairs",void 0),$=v([S("team-flair-selection-modal")],$);
//# sourceMappingURL=team-flair-selection-client-js-1d945109.js.map
